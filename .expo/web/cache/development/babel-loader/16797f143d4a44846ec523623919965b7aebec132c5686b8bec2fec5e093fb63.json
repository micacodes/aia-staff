{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nconsole.log(\"✅ API_BASE_URL from .env:\", process.env.API_BASE_URL);\nconsole.log(\"✅ API_BASE_VERSION from .env:\", process.env.API_BASE_VERSION);\nimport axios from \"axios\";\nimport { getAuthenticatedSession, killAuthenticatedSession } from \"./auth\";\nvar API_BASE_URL = process.env.API_BASE_URL || \"https://osen-api.appinapp.ke\";\nvar API_BASE_VERSION = process.env.API_BASE_VERSION || \"v1\";\nvar http = axios.create({\n  baseURL: `${API_BASE_URL}/${API_BASE_VERSION}`,\n  withCredentials: true,\n  headers: {\n    \"Content-Type\": \"application/json\",\n    Accept: 'application/json'\n  }\n});\nvar handleResponse = function handleResponse(response) {\n  return response;\n};\nvar handleError = function handleError() {\n  var reason = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"expired\";\n  return reason;\n};\nhttp.interceptors.request.use(function () {\n  var _ref = _asyncToGenerator(function* (config) {\n    var session = yield getAuthenticatedSession();\n    console.log('Session:', session);\n    if (config.headers && session && session.sessionToken) {\n      config.headers.Authorization = `Bearer ${session.sessionToken}`;\n    }\n    console.info({\n      config: config\n    });\n    return config;\n  });\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}(), function (error) {\n  return Promise.reject(error);\n});\nhttp.interceptors.response.use(function (response) {\n  handleResponse(response);\n  return response;\n}, function () {\n  var _ref2 = _asyncToGenerator(function* (error) {\n    var _error$response, _error$response2, _error$response3;\n    if (401 === ((_error$response = error.response) == null ? void 0 : _error$response.status)) {\n      killAuthenticatedSession();\n      return Promise.reject(error);\n    } else if (404 === ((_error$response2 = error.response) == null ? void 0 : _error$response2.status)) {\n      handleResponse(error.response);\n    } else if (422 === ((_error$response3 = error.response) == null ? void 0 : _error$response3.status)) {\n      console.error(error.response.data);\n      handleResponse(error.response);\n      return Promise.reject(error);\n    } else {\n      handleResponse(error.response);\n      return Promise.reject(error);\n    }\n  });\n  return function (_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}());\nvar buildQueryString = function buildQueryString(query) {\n  if (query) {\n    var keys = Object.keys(query);\n    return keys.length ? \"?\" + keys.map(function (k) {\n      return `${k}=${query[k]}`;\n    }).join(\"&\") : \"\";\n  }\n  return \"\";\n};\nexport var imagePath = function imagePath(path) {\n  var defaultImage = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"\";\n  if (path != null && path.includes(\"amazonaws\")) {\n    return path;\n  }\n  return path ? `${API_BASE_URL}${path}` : defaultImage || \"https://appinapp.co.ke/vapp-landing/img/footer-logo.png\";\n};\nexport var api = {\n  get: function () {\n    var _get = _asyncToGenerator(function* (path, query, options) {\n      var _yield$http$get = yield http.get(path + buildQueryString(query), options),\n        data = _yield$http$get.data;\n      return data;\n    });\n    function get(_x3, _x4, _x5) {\n      return _get.apply(this, arguments);\n    }\n    return get;\n  }(),\n  post: function () {\n    var _post = _asyncToGenerator(function* (path) {\n      var payload = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var options = arguments.length > 2 ? arguments[2] : undefined;\n      var _yield$http$post = yield http.post(path, payload, options),\n        data = _yield$http$post.data;\n      return data;\n    });\n    function post(_x6) {\n      return _post.apply(this, arguments);\n    }\n    return post;\n  }(),\n  put: function () {\n    var _put = _asyncToGenerator(function* (path) {\n      var payload = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var options = arguments.length > 2 ? arguments[2] : undefined;\n      var _yield$http$put = yield http.put(path, payload, options),\n        data = _yield$http$put.data;\n      return data;\n    });\n    function put(_x7) {\n      return _put.apply(this, arguments);\n    }\n    return put;\n  }(),\n  patch: function () {\n    var _patch = _asyncToGenerator(function* (path) {\n      var payload = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var options = arguments.length > 2 ? arguments[2] : undefined;\n      var _yield$http$patch = yield http.patch(path, payload, options),\n        data = _yield$http$patch.data;\n      return data;\n    });\n    function patch(_x8) {\n      return _patch.apply(this, arguments);\n    }\n    return patch;\n  }(),\n  destroy: function () {\n    var _destroy = _asyncToGenerator(function* (id) {\n      var path = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"users\";\n      var options = arguments.length > 2 ? arguments[2] : undefined;\n      var _yield$http$delete = yield http.delete(`/${path}/${id}`, options),\n        data = _yield$http$delete.data;\n      return data;\n    });\n    function destroy(_x9) {\n      return _destroy.apply(this, arguments);\n    }\n    return destroy;\n  }()\n};","map":{"version":3,"names":["console","log","process","env","API_BASE_URL","API_BASE_VERSION","axios","getAuthenticatedSession","killAuthenticatedSession","http","create","baseURL","withCredentials","headers","Accept","handleResponse","response","handleError","reason","arguments","length","undefined","interceptors","request","use","_ref","_asyncToGenerator","config","session","sessionToken","Authorization","info","_x","apply","error","Promise","reject","_ref2","_error$response","_error$response2","_error$response3","status","data","_x2","buildQueryString","query","keys","Object","map","k","join","imagePath","path","defaultImage","includes","api","get","_get","options","_yield$http$get","_x3","_x4","_x5","post","_post","payload","_yield$http$post","_x6","put","_put","_yield$http$put","_x7","patch","_patch","_yield$http$patch","_x8","destroy","_destroy","id","_yield$http$delete","delete","_x9"],"sources":["/home/micah/Documents/aia-staff-osen-main/utils/api.ts"],"sourcesContent":["console.log(\"✅ API_BASE_URL from .env:\", process.env.API_BASE_URL);\nconsole.log(\"✅ API_BASE_VERSION from .env:\", process.env.API_BASE_VERSION);\n\n\nimport axios, {\n\tAxiosError,\n\tAxiosResponse,\n\tAxiosInstance,\n\tAxiosRequestConfig,\n\tInternalAxiosRequestConfig,\n} from \"axios\";\nimport { getAuthenticatedSession, killAuthenticatedSession } from \"./auth\";\n\nconst API_BASE_URL =\n  process.env.API_BASE_URL || \"https://osen-api.appinapp.ke\";\nconst API_BASE_VERSION = process.env.API_BASE_VERSION || \"v1\";\n\nconst http: AxiosInstance = axios.create({\n\tbaseURL: `${API_BASE_URL}/${API_BASE_VERSION}`,\n\twithCredentials: true,\n\theaders: {\n\t\t\"Content-Type\": \"application/json\",\n\t\tAccept: 'application/json'\n\t},\n});\n\nconst handleResponse = (response: AxiosResponse | undefined) => response;\n\nconst handleError = (reason: string | number = \"expired\") => reason;\n\nhttp.interceptors.request.use(\n\tasync (config: InternalAxiosRequestConfig) => {\n\t\tconst session = await getAuthenticatedSession();\n\t\tconsole.log('Session:', session);\n\t\tif (config.headers && session && session.sessionToken) {\n\t\t\tconfig.headers.Authorization = `Bearer ${session.sessionToken}`;\n\t\t}\n\n\t\tconsole.info({ config });\n\n\t\treturn config;\n\t},\n\terror => Promise.reject(error)\n);\n\nhttp.interceptors.response.use(\n\t(response: AxiosResponse) => {\n\t\thandleResponse(response);\n\n\t\treturn response;\n\t},\n\tasync (error: AxiosError) => {\n\t\tif (401 === error.response?.status) {\n\t\t\tkillAuthenticatedSession();\n\n\t\t\treturn Promise.reject(error);\n\t\t} else if (404 === error.response?.status) {\n\t\t\thandleResponse(error.response);\n\t\t} else if (422 === error.response?.status) {\n\t\t\tconsole.error(error.response.data);\n\t\t\t// if((error.response.data as any).errors) {\n\t\t\t// \tconst errors: Record<string, string|number>[] = error.response.data.errors;\n\t\t\t// \thandleResponse(errors.reduce((acc, cur) => {\n\t\t\t// \t\tacc[cur.field] = cur.message;\n\t\t\t// \t\treturn acc;\n\t\t\t// \t}, {} as Record<string, string|number>));\n\t\t\t// }\n\n\t\t\thandleResponse(error.response);\n\t\t\treturn Promise.reject(error);\n\t\t} else {\n\t\t\thandleResponse(error.response);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\t}\n);\n\nconst buildQueryString = (query?: Record<string, string | number>): string => {\n\tif (query) {\n\t\tconst keys = Object.keys(query);\n\t\treturn keys.length\n\t\t\t? \"?\" + keys.map(k => `${k}=${query[k]}`).join(\"&\")\n\t\t\t: \"\";\n\t}\n\n\treturn \"\";\n};\n\nexport const imagePath = (\n\tpath: string | undefined | null,\n\tdefaultImage = \"\"\n): string => {\n\tif (path?.includes(\"amazonaws\")) {\n\t\treturn path;\n\t}\n\n\treturn path\n\t\t? `${API_BASE_URL}${path}`\n\t\t: defaultImage ||\n\t\t\t\t\"https://appinapp.co.ke/vapp-landing/img/footer-logo.png\";\n};\n\nexport const api: {\n\tget: <T>(\n\t\tpath: string,\n\t\tquery?: Record<string, string | number>,\n\t\toptions?: AxiosRequestConfig\n\t) => Promise<T | undefined>;\n\tpost: <T>(\n\t\tpath: string,\n\t\tpayload?: Record<string, unknown> | Partial<T> | FormData,\n\t\toptions?: AxiosRequestConfig\n\t) => Promise<T | undefined>;\n\tput: <T>(\n\t\tpath: string,\n\t\tpayload?: Record<string, unknown> | Partial<T> | FormData,\n\t\toptions?: AxiosRequestConfig\n\t) => Promise<T | undefined>;\n\tpatch: <T>(\n\t\tpath: string,\n\t\tpayload?: Record<string, unknown> | Partial<T> | FormData,\n\t\toptions?: AxiosRequestConfig\n\t) => Promise<T | undefined>;\n\tdestroy: <T>(\n\t\tid: number | string,\n\t\tpath?: string,\n\t\toptions?: AxiosRequestConfig\n\t) => Promise<T | undefined>;\n} = {\n\tget: async <T>(\n\t\tpath: string,\n\t\tquery?: Record<string, string | number>,\n\t\toptions?: AxiosRequestConfig\n\t): Promise<T | undefined> => {\n\t\tconst { data } = await http.get(\n\t\t\tpath + buildQueryString(query),\n\t\t\toptions\n\t\t);\n\n\t\treturn data;\n\t},\n\n\tpost: async <T>(\n\t\tpath: string,\n\t\tpayload = {},\n\t\toptions?: AxiosRequestConfig\n\t): Promise<T | undefined> => {\n\t\tconst { data } = await http.post(path, payload, options);\n\n\t\treturn data;\n\t},\n\n\tput: async <T>(\n\t\tpath: string,\n\t\tpayload = {},\n\t\toptions?: AxiosRequestConfig\n\t): Promise<T | undefined> => {\n\t\tconst { data } = await http.put(path, payload, options);\n\n\t\treturn data;\n\t},\n\tpatch: async <T>(\n\t\tpath: string,\n\t\tpayload = {},\n\t\toptions?: AxiosRequestConfig\n\t): Promise<T | undefined> => {\n\t\tconst { data } = await http.patch(path, payload, options);\n\n\t\treturn data;\n\t},\n\tdestroy: async <T>(\n\t\tid: number | string,\n\t\tpath = \"users\",\n\t\toptions?: AxiosRequestConfig\n\t): Promise<T | undefined> => {\n\t\tconst { data } = await http.delete(`/${path}/${id}`, options);\n\n\t\treturn data;\n\t},\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}