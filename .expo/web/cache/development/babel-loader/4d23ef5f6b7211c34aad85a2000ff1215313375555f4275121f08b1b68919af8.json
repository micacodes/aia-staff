{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/home/micah/Documents/aia-staff-osen-main/providers/AuthProvider.tsx\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport { createContext, useEffect, useState } from \"react\";\nimport { getAuthenticatedSession, killAuthenticatedSession, setAuthenticatedSession } from \"../utils/auth\";\nimport { api } from \"../utils/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport var AuthContext = createContext({\n  setSession: function setSession() {},\n  syncSession: function syncSession() {\n    return Promise.resolve();\n  },\n  logOut: function logOut() {},\n  didFetch: false,\n  isAuthenticated: false\n});\nexport default function AuthContextProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(undefined),\n    _useState2 = _slicedToArray(_useState, 2),\n    vendor = _useState2[0],\n    setVendor = _useState2[1];\n  var _useState3 = useState(undefined),\n    _useState4 = _slicedToArray(_useState3, 2),\n    branch = _useState4[0],\n    setBranch = _useState4[1];\n  var _useState5 = useState(undefined),\n    _useState6 = _slicedToArray(_useState5, 2),\n    sessionContext = _useState6[0],\n    setSessionContext = _useState6[1];\n  useEffect(function () {\n    getAuthenticatedSession().then(_syncSession);\n  }, []);\n  var _syncSession = function () {\n    var _ref2 = _asyncToGenerator(function* (auth) {\n      if (!(auth != null && auth.sessionToken)) {\n        return setSession(null);\n      }\n      try {\n        var user = yield api.get(\"auth/me\", {});\n        setSessionContext(_objectSpread(_objectSpread({}, sessionContext), {}, {\n          sessionToken: auth.sessionToken,\n          session: {\n            firstName: user.firstName,\n            lastName: user.lastName,\n            email: user.email,\n            phone: user.phone,\n            avatarUrl: user.avatarUrl,\n            id: user.id,\n            vendor: auth.session.vendor,\n            branch: auth.session.branch\n          }\n        }));\n      } catch (err) {\n        var _err$response;\n        if (((_err$response = err.response) == null ? void 0 : _err$response.status) === 401) {\n          console.log(\"Session is not authenticated:\", err);\n        } else {\n          console.error(err);\n        }\n        setSessionContext(null);\n      }\n    });\n    return function syncSession(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var setSession = function () {\n    var _ref3 = _asyncToGenerator(function* (session) {\n      setVendor(session == null ? void 0 : session.session.vendor);\n      setBranch(session == null ? void 0 : session.session.branch);\n      if (!session) {\n        yield killAuthenticatedSession();\n        return setSessionContext(session);\n      }\n      setAuthenticatedSession(session).then(function () {\n        return _syncSession(session);\n      });\n    });\n    return function setSession(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var logOut = function logOut() {\n    killAuthenticatedSession().then(function () {\n      return setSessionContext(null);\n    });\n  };\n  if (sessionContext === undefined) {\n    return null;\n  }\n  return _jsxDEV(AuthContext.Provider, {\n    value: {\n      session: sessionContext == null ? void 0 : sessionContext.session,\n      sessionToken: sessionContext == null ? void 0 : sessionContext.sessionToken,\n      isAuthenticated: Boolean(sessionContext == null ? void 0 : sessionContext.sessionToken),\n      syncSession: function syncSession() {\n        return getAuthenticatedSession().then(_syncSession);\n      },\n      setSession: setSession,\n      logOut: logOut,\n      didFetch: true\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 3\n  }, this);\n}","map":{"version":3,"names":["createContext","useEffect","useState","getAuthenticatedSession","killAuthenticatedSession","setAuthenticatedSession","api","jsxDEV","_jsxDEV","AuthContext","setSession","syncSession","Promise","resolve","logOut","didFetch","isAuthenticated","AuthContextProvider","_ref","children","_useState","undefined","_useState2","_slicedToArray","vendor","setVendor","_useState3","_useState4","branch","setBranch","_useState5","_useState6","sessionContext","setSessionContext","then","_ref2","_asyncToGenerator","auth","sessionToken","user","get","_objectSpread","session","firstName","lastName","email","phone","avatarUrl","id","err","_err$response","response","status","console","log","error","_x","apply","arguments","_ref3","_x2","Provider","value","Boolean","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/home/micah/Documents/aia-staff-osen-main/providers/AuthProvider.tsx"],"sourcesContent":["import { createContext, ReactNode, useEffect, useState } from \"react\";\nimport {\n\tgetAuthenticatedSession,\n\tkillAuthenticatedSession,\n\tSessionContext,\n\tsetAuthenticatedSession,\n} from \"../utils/auth\";\nimport { api } from \"../utils/api\";\n\ninterface Context {\n\tsession?: {\n\t\tfirstName?: string;\n\t\tlastName?: string;\n\t\temail?: string;\n\t\tphone?: string;\n\t\tavatarUrl?: string;\n\t\tid?: string;\n\t\tvendor: Vendor;\n\t\tbranch: Branch;\n\t};\n\tsessionToken?: string;\n\tsetSession: (session: SessionContext) => void;\n\tsyncSession: () => Promise<void>;\n\tlogOut: () => void;\n\tdidFetch: boolean;\n\tisAuthenticated: boolean;\n}\n\nexport const AuthContext = createContext<Context>({\n\tsetSession: () => {},\n\tsyncSession: () => Promise.resolve(),\n\tlogOut: () => {},\n\tdidFetch: false,\n\tisAuthenticated: false,\n});\n\ninterface AuthContextProps {\n\tchildren: ReactNode;\n}\n\nexport default function AuthContextProvider({ children }: AuthContextProps) {\n\tconst [vendor, setVendor] = useState<Vendor | undefined>(undefined);\n\tconst [branch, setBranch] = useState<Branch | undefined>(undefined);\n\tconst [sessionContext, setSessionContext] = useState<\n\t\tSessionContext | undefined\n\t>(undefined);\n\n\tuseEffect(() => {\n\t\tgetAuthenticatedSession().then(syncSession);\n\t}, []);\n\n\tconst syncSession = async (auth: { sessionToken?: string, session: {\n        firstName: string;\n        lastName: string;\n        email: string;\n        phone: string;\n        avatarUrl: string;\n        id: string;\n        vendor: Vendor;\n        branch: Branch;\n    };}) => {\n\t\tif (!auth?.sessionToken) {\n\t\t\treturn setSession(null);\n\t\t}\n\n\t\ttry {\n\t\t\tconst user: any = await api.get(\"auth/me\", {});\n\t\t\tsetSessionContext({\n\t\t\t\t...sessionContext,\n\t\t\t\tsessionToken: auth.sessionToken,\n\t\t\t\tsession: {\n\t\t\t\t\tfirstName: user.firstName,\n\t\t\t\t\tlastName: user.lastName,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\tphone: user.phone,\n\t\t\t\t\tavatarUrl: user.avatarUrl,\n\t\t\t\t\tid: user.id,\n\t\t\t\t\tvendor: auth.session.vendor,\n\t\t\t\t\tbranch: auth.session.branch,\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (err: any) {\n\t\t\tif (err.response?.status === 401) {\n\t\t\t\t// The user is no longer logged in (hence 401)\n\t\t\t\tconsole.log(\"Session is not authenticated:\", err);\n\t\t\t} else {\n\t\t\t\t// A network or some other error occurred\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\n\t\t\t// Remove the session / log the user out.\n\t\t\tsetSessionContext(null);\n\t\t}\n\t};\n\n\tconst setSession = async (session: SessionContext) => {\n\t\tsetVendor(session?.session.vendor);\n\t\tsetBranch(session?.session.branch);\n    \n\t\tif (!session) {\n\t\t\tawait killAuthenticatedSession();\n\t\t\treturn setSessionContext(session);\n\t\t}\n\n\t\tsetAuthenticatedSession(session).then(() => syncSession(session));\n\t};\n\n\tconst logOut = () => {\n\t\tkillAuthenticatedSession().then(() => setSessionContext(null));\n\t};\n\n\tif (sessionContext === undefined) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<AuthContext.Provider\n\t\t\tvalue={{\n\t\t\t\tsession: sessionContext?.session,\n\t\t\t\tsessionToken: sessionContext?.sessionToken,\n\n\t\t\t\tisAuthenticated: Boolean(sessionContext?.sessionToken),\n\n\t\t\t\tsyncSession: () => getAuthenticatedSession().then(syncSession),\n\n\t\t\t\tsetSession,\n\n\t\t\t\tlogOut,\n\n\t\t\t\tdidFetch: true,\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</AuthContext.Provider>\n\t);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}